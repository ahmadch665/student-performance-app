{% extends "base.html" %}

{% block content %}
<style>
  /* Uniform dark background */
  html, body {
    min-height: 100vh;
    margin: 0;
    background-color: #121212 !important;
    color: #ecf0f1;
  }

  h2 {
    color: #1abc9c;
    font-weight: 600;
  }

  .table {
    background: #1e272e;
    color: #ecf0f1;
    border-radius: 12px;
    overflow: hidden;
  }

  .table th {
    background-color: #2c3e50 !important;
    color: #ecf0f1;
  }

  .table td {
    vertical-align: middle;
  }

  .form-control, .form-select {
    background-color: #2c3e50;
    color: #f5f6fa;
    border: 1px solid #444;
  }

  .form-control:focus, .form-select:focus {
    background-color: #353b48;
    color: #fff;
    border-color: #1abc9c;
    box-shadow: 0 0 5px rgba(26, 188, 156, 0.7);
  }

  .btn-success {
    background: #1abc9c;
    border: none;
    transition: 0.3s;
  }
  .btn-success:hover {
    background: #16a085;
  }

  .btn-danger {
    background: #e74c3c;
    border: none;
    transition: 0.3s;
  }
  .btn-danger:hover {
    background: #c0392b;
  }

  .btn-secondary {
    background: #7f8c8d;
    border: none;
    transition: 0.3s;
  }
  .btn-secondary:hover {
    background: #636e72;
  }

  .alert {
    border-radius: 8px;
  }
</style>

<div class="container mt-5">

  <!-- Flash messages -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="alert alert-{{ 'success' if category=='success' else 'danger' }} alert-dismissible fade show" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <h2 class="mb-4">Faculty & Advisor List</h2>

  <div class="table-responsive shadow">
    <table class="table table-bordered table-striped mt-4">
      <thead>
        <tr>
          <th>ID</th>
          <th>Username</th>
          <th>Email</th>
          <th>Role</th>
          <th>Subjects</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for user in faculty_advisors %}
        <tr>
          <form method="POST" action="{{ url_for('update_user', user_id=user.id) }}">
            <td>{{ user.id }}</td>
            <td><input type="text" name="username" value="{{ user.username }}" class="form-control"></td>
            <td><input type="email" name="email" value="{{ user.email }}" class="form-control"></td>
            <td>
              <select name="role" class="form-select" onchange="toggleSubjectInput(this, {{ user.id }})">
                <option value="2" {% if user.role_id==2 %}selected{% endif %}>Faculty</option>
                <option value="3" {% if user.role_id==3 %}selected{% endif %}>Advisor</option>
              </select>
            </td>
            <td>
              {% if user.role_id == 2 %}
                <input type="text" name="subjects" value="{{ user.subjects if user.subjects else '' }}"
                       class="form-control" placeholder="Comma separated (faculty only)"
                       id="subjects-{{ user.id }}">
              {% else %}
                <span class="text-muted">N/A</span>
              {% endif %}
            </td>
            <td>
              <button type="submit" class="btn btn-sm btn-success">Save</button>
              <a href="{{ url_for('delete_user', user_id=user.id) }}"
                 class="btn btn-sm btn-danger"
                 onclick="return confirm('Are you sure you want to delete this user?');">Delete</a>
            </td>
          </form>
        </tr>
        {% else %}
        <tr>
          <td colspan="6" class="text-center text-muted">No faculty or advisors found.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <a href="{{ url_for('predict') }}" class="btn btn-secondary mt-3">â¬… Back to Admin Dashboard</a>
</div>

<script>
function toggleSubjectInput(selectEl, userId) {
    const subjInput = document.getElementById('subjects-' + userId);
    if(subjInput) {
        if(selectEl.value == '2'){ // Faculty
            subjInput.style.display = 'block';
        } else { // Advisor
            subjInput.style.display = 'none';
            subjInput.value = '';
        }
    }
}
</script>
{% endblock %}
